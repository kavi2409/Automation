<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EFA Proposal Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .consultant-entry {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .consultant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .consultant-header h3 {
            color: #333;
            font-size: 16px;
        }
        
        .btn-remove {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-remove:hover {
            background: #c82333;
        }
        
        .btn-add {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .btn-add:hover {
            background: #218838;
        }
        
        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s;
        }
        
        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .section-title {
            background: #667eea;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            margin: 30px 0 20px 0;
            font-size: 16px;
            font-weight: 600;
        }
        
        .hidden {
            display: none;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 13px;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>EFA Proposal Generator</h1>
        <p class="subtitle">Fill in the form below to generate your proposal document</p>
        
        <div class="info-box">
            üìù Complete all required fields. The system will automatically calculate prices and format your proposal.
        </div>
        
        <form id="proposalForm">
            <!-- Basic Information -->
            <div class="section-title">Basic Information</div>
            
            <div class="row">
                <div class="form-group">
                    <label for="name">Name and Surname *</label>
                    <input type="text" id="name" required>
                </div>
                
                <div class="form-group">
                    <label for="department">Department/Directorate *</label>
                    <input type="text" id="department" required>
                </div>
            </div>
            
            <div class="row">
                <div class="form-group">
                    <label for="company">Company Name *</label>
                    <input type="text" id="company" required>
                </div>
                
                <div class="form-group">
                    <label for="date">Date *</label>
                    <input type="date" id="date" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="proposalTitle">Proposal Title *</label>
                <input type="text" id="proposalTitle" required>
            </div>
            
            <div class="form-group">
                <label for="generalInfo">General Information and Introduction *</label>
                <textarea id="generalInfo" required></textarea>
            </div>
            
            <!-- Pricing Information -->
            <div class="section-title">Pricing Information</div>
            
            <div class="form-group">
                <label for="proposalType">Select Proposal Type *</label>
                <select id="proposalType" required>
                    <option value="">-- Select Type --</option>
                    <option value="deliverables">Deliverables</option>
                    <option value="timesheets">Timesheets</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="finalPrice">Final Price (¬£) *</label>
                <input type="number" id="finalPrice" step="0.01" required>
            </div>
            
            <!-- Deliverables Section -->
            <div id="deliverablesSection" class="hidden">
                <div class="row">
                    <div class="form-group">
                        <label for="timePeriodNumber">Number of Weeks/Months *</label>
                        <input type="number" id="timePeriodNumber">
                    </div>
                    
                    <div class="form-group">
                        <label for="timePeriodUnit">Period Unit *</label>
                        <select id="timePeriodUnit">
                            <option value="week">Week</option>
                            <option value="month">Month</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="ratePerPeriod">Rate per Week/Month (¬£)</label>
                    <input type="number" id="ratePerPeriod" step="0.01" readonly>
                </div>
            </div>
            
            <!-- Timesheets Section -->
            <div id="timesheetsSection" class="hidden">
                <div id="consultantsContainer"></div>
                <button type="button" class="btn-add" onclick="addConsultant()">+ Add Consultant</button>
            </div>
            
            <!-- Detailed Information -->
            <div class="section-title">Detailed Information</div>
            
            <div class="form-group">
                <label for="detailedInfo">Detailed Information *</label>
                <textarea id="detailedInfo" placeholder="Detailed information regarding the proposed work analysed following meetings or discussions with clients. Use bullet points and tables." required></textarea>
            </div>
            
            <div class="form-group">
                <label for="scope">Scope *</label>
                <textarea id="scope" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="deliverables">Deliverables *</label>
                <textarea id="deliverables" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="resources">Resources *</label>
                <textarea id="resources" required></textarea>
            </div>
            
            <!-- Duration -->
            <div class="section-title">Duration</div>
            
            <div class="form-group">
                <label for="duration">Duration (e.g., "4 weeks" or "6 months") *</label>
                <input type="text" id="duration" placeholder="e.g., 4 weeks" required>
            </div>
            
            <div class="row">
                <div class="form-group">
                    <label for="startDate">Starting Date *</label>
                    <input type="date" id="startDate" required>
                </div>
                
                <div class="form-group">
                    <label for="endDate">Ending Date *</label>
                    <input type="date" id="endDate" required>
                </div>
            </div>
            
            <!-- Commercial Terms -->
            <div class="section-title">Commercial Terms</div>
            
            <div class="form-group">
                <label for="contractType">Contract Type *</label>
                <select id="contractType" required>
                    <option value="">-- Select Contract Type --</option>
                    <option value="NR26">NR26: Professional Service Short Contract (PSSC)</option>
                    <option value="NEC4">NEC4: Professional Service Short Contract</option>
                    <option value="NR3">NR3: Contract</option>
                    <option value="PSR:SOW">PSR:SOW Framework</option>
                </select>
            </div>
            
            <button type="submit" class="btn-generate">Generate Proposal Document</button>
        </form>
    </div>

    <script>
        let consultantCount = 0;
        
        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();
        
        // Handle proposal type change
        document.getElementById('proposalType').addEventListener('change', function() {
            const deliverablesSection = document.getElementById('deliverablesSection');
            const timesheetsSection = document.getElementById('timesheetsSection');
            
            if (this.value === 'deliverables') {
                deliverablesSection.classList.remove('hidden');
                timesheetsSection.classList.add('hidden');
                calculateRate();
            } else if (this.value === 'timesheets') {
                deliverablesSection.classList.add('hidden');
                timesheetsSection.classList.remove('hidden');
            } else {
                deliverablesSection.classList.add('hidden');
                timesheetsSection.classList.add('hidden');
            }
        });
        
        // Auto-calculate rate per period for deliverables
        document.getElementById('finalPrice').addEventListener('input', calculateRate);
        document.getElementById('timePeriodNumber').addEventListener('input', calculateRate);
        
        function calculateRate() {
            const proposalType = document.getElementById('proposalType').value;
            if (proposalType === 'deliverables') {
                const price = parseFloat(document.getElementById('finalPrice').value) || 0;
                const periods = parseFloat(document.getElementById('timePeriodNumber').value) || 1;
                const rate = price / periods;
                document.getElementById('ratePerPeriod').value = rate.toFixed(2);
            }
        }
        
        function addConsultant() {
            consultantCount++;
            const container = document.getElementById('consultantsContainer');
            const consultantDiv = document.createElement('div');
            consultantDiv.className = 'consultant-entry';
            consultantDiv.id = `consultant-${consultantCount}`;
            consultantDiv.innerHTML = `
                <div class="consultant-header">
                    <h3>Consultant ${consultantCount}</h3>
                    <button type="button" class="btn-remove" onclick="removeConsultant(${consultantCount})">Remove</button>
                </div>
                <div class="form-group">
                    <label>Job Title *</label>
                    <input type="text" name="jobTitle-${consultantCount}" required>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Charge Rate (¬£) *</label>
                        <input type="number" name="chargeRate-${consultantCount}" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Total Shifts *</label>
                        <input type="number" name="totalShifts-${consultantCount}" required>
                    </div>
                </div>
            `;
            container.appendChild(consultantDiv);
        }
        
        function removeConsultant(id) {
            const element = document.getElementById(`consultant-${id}`);
            if (element) {
                element.remove();
            }
        }
        
        function numberToWords(num) {
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            
            if (num === 0) return 'Zero';
            
            let words = '';
            
            if (num >= 1000000) {
                words += numberToWords(Math.floor(num / 1000000)) + ' Million ';
                num %= 1000000;
            }
            
            if (num >= 1000) {
                words += numberToWords(Math.floor(num / 1000)) + ' Thousand ';
                num %= 1000;
            }
            
            if (num >= 100) {
                words += ones[Math.floor(num / 100)] + ' Hundred ';
                num %= 100;
            }
            
            if (num >= 20) {
                words += tens[Math.floor(num / 10)] + ' ';
                num %= 10;
            } else if (num >= 10) {
                words += teens[num - 10] + ' ';
                return words.trim();
            }
            
            if (num > 0) {
                words += ones[num] + ' ';
            }
            
            return words.trim();
        }
        
        function priceToWords(price) {
            const pounds = Math.floor(price);
            const pence = Math.round((price - pounds) * 100);
            
            let result = numberToWords(pounds) + ' Pounds';
            
            if (pence > 0) {
                result += ' and ' + numberToWords(pence) + ' Pence';
            }
            
            return result;
        }
        
        function getContractText(contractType) {
            const contracts = {
                'NR26': 'Our offer is conditional upon the use of the NR26 Professional Service Short Contract (PSSC).',
                'NEC4': 'Our offer is conditional upon the use of the NEC4 Professional Service Short Contract.',
                'NR3': 'Our offer is conditional upon the use of the NR3 Contract.',
                'PSR:SOW': 'The proposal has been built on the basis that it will be instructed via the PSR:SOW framework and fall under the associated contractual terms. All fees associated with the use of the framework have been incorporated into the prices presented within this proposal.'
            };
            return contracts[contractType] || '';
        }
        
        document.getElementById('proposalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect form data
            const formData = {
                name: document.getElementById('name').value,
                department: document.getElementById('department').value,
                company: document.getElementById('company').value,
                date: document.getElementById('date').value,
                proposalTitle: document.getElementById('proposalTitle').value,
                generalInfo: document.getElementById('generalInfo').value,
                finalPrice: parseFloat(document.getElementById('finalPrice').value),
                proposalType: document.getElementById('proposalType').value,
                detailedInfo: document.getElementById('detailedInfo').value,
                scope: document.getElementById('scope').value,
                deliverables: document.getElementById('deliverables').value,
                resources: document.getElementById('resources').value,
                duration: document.getElementById('duration').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                contractType: document.getElementById('contractType').value
            };
            
            // Generate pricing text
            let pricingText = '';
            if (formData.proposalType === 'deliverables') {
                const periods = document.getElementById('timePeriodNumber').value;
                const unit = document.getElementById('timePeriodUnit').value;
                const rate = document.getElementById('ratePerPeriod').value;
                pricingText = `The price covers a ${periods}-${unit} period, based upon ¬£${rate} per ${unit}.`;
            } else if (formData.proposalType === 'timesheets') {
                pricingText = 'The price is based upon the below charge out rates and shifts:\n\n';
                const consultants = document.querySelectorAll('.consultant-entry');
                consultants.forEach((consultant, index) => {
                    const jobTitle = consultant.querySelector(`input[name^="jobTitle"]`).value;
                    const chargeRate = consultant.querySelector(`input[name^="chargeRate"]`).value;
                    const totalShifts = consultant.querySelector(`input[name^="totalShifts"]`).value;
                    pricingText += `${jobTitle} for ¬£${chargeRate} per shift and an anticipated combined number of ${totalShifts} total shifts.\n`;
                });
            }
            
            // Generate document content
            const priceInWords = priceToWords(formData.finalPrice);
            const contractText = getContractText(formData.contractType);
            
            const documentContent = `
FAO: ${formData.name}
${formData.department}
${formData.company}

${formData.date}

Private and Confidential

Dear ${formData.name},

Re: ${formData.proposalTitle}

${formData.generalInfo}

Our price for the work is ¬£${formData.finalPrice.toFixed(2)} (${priceInWords}). Excluding VAT.

${pricingText}

Please see full details of scope and deliverables on the following pages:

${formData.detailedInfo}

Scope

${formData.scope}

Deliverables

${formData.deliverables}

Resources

${formData.resources}

DURATION

The duration of the work is ${formData.duration}, commencing on ${formData.startDate} and concluding on ${formData.endDate}. The project will be billed periodically with the payment application being supported by an up-to-date delivery programme.

COMMERCIAL

${contractText}

The law of the contract is the Law of England and Wales.
The assessment day is within 28 days from the starting date.
The rate for delay damages is ¬£0 per day.
The period for reply is 2 weeks.

EFA Engineering holds Professional Indemnity insurance of up to ¬£5 million and Public Liability insurance of up to ¬£5 million. Our liability for any matter is limited to 10% of the contract Price.

Yours sincerely

Alex Edwards
Managing Director
+44 (0)7734 646510

EFA Engineering Limited
128 City Road,
London,
United Kingdom,
EC1V 2NX
            `.trim();
            
            // Create and download the document
            const blob = new Blob([documentContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Proposal_${formData.proposalTitle.replace(/\s+/g, '_')}_${formData.date}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            alert('Proposal document generated successfully!');
        });
    </script>
</body>
</html>